<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <style>
      /* Basic layout styles for header and sidebar menu */
      body {
        display: flex;
        margin: 0;
        font-family: Arial, sans-serif;
        min-height: 100vh;
        background-color: #f8f8f8;
      }

      /* Fixed header on top */
      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: #667eea;
        color: white;
        display: flex;
        align-items: center;
        padding: 0 20px;
        font-size: 24px;
        font-weight: 700;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

      /* Sidebar fixed under header */
      nav {
        position: fixed;
        top: 60px; /* below header */
        left: 0;
        width: 220px;
        bottom: 0;
        background-color: #2c2f4a;
        padding-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        overflow-y: auto;
      }

      nav a {
        color: #ddd;
        text-decoration: none;
        padding: 12px 20px;
        font-weight: 600;
        transition: background-color 0.3s;
      }

      nav a:hover,
      nav a.active {
        background-color: #667eea;
        color: white;
      }

      /* Main content area */
      main {
        margin-left: 220px;
        margin-top: 60px;
        padding: 20px;
        flex-grow: 1;
        min-height: calc(100vh - 60px);
        overflow-y: auto;
      }

      /* Top bar inside main for welcome and logout */
      #topBar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 10px 15px;
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      #logoutBtn {
        padding: 6px 12px;
        background-color: #d9534f;
        border: none;
        border-radius: 4px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      #logoutBtn:hover {
        background-color: #c9302c;
      }

      /* Form styling */
      form {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        max-width: 400px;
      }

      form input[type="text"],
      form input[type="number"],
      form input[type="file"] {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 16px;
        box-sizing: border-box;
      }

      form button {
        background-color: #667eea;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        transition: background-color 0.3s ease;
      }

      form button:hover {
        background-color: #5563c1;
      }

      /* Products container */
      #adminProducts {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 15px;
      }

      /* Each product card */
      .product {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        width: 220px;
        padding: 15px;
        box-sizing: border-box;
        text-align: center;
      }

      .product img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 6px;
      }

      /* Responsive for small screens */
      @media (max-width: 700px) {
        body {
          flex-direction: column;
        }
        nav {
          position: relative;
          width: 100%;
          height: auto;
          flex-direction: row;
          justify-content: space-around;
          padding: 10px 0;
          top: 0;
          box-shadow: none;
        }
        main {
          margin-left: 0;
          margin-top: 10px;
          padding: 10px;
          min-height: auto;
        }
        header {
          position: relative;
          height: auto;
          padding: 15px 20px;
          text-align: center;
          font-size: 28px;
        }
        #topBar {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }
      }
    </style>
</head>
<body>

<header>
    My Admin Dashboard
</header>

<nav>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="#addProductSection" id="menuAddProduct">Add Product</a>
    <a href="#yourProductsSection" id="menuYourProducts">Your Products</a>
</nav>

<main>
    <div id="topBar">
        <span id="welcome"></span>
        <button id="logoutBtn">Logout</button>
    </div>

    <section id="addProductSection">
      <h2>Add New Product</h2>
      <form id="productForm">
          <input type="text" placeholder="Product Name" id="productName" required />
          <input type="number" placeholder="Price (₱)" id="productPrice" required />
          <input type="text" placeholder="Reseller Name" id="reseller" required />
          <input type="file" id="imageFile" accept="image/*" required />
          <button type="submit">Add Product</button>
      </form>
    </section>

    <section id="yourProductsSection" style="margin-top:40px;">
      <h3>Your Products:</h3>
      <div id="adminProducts"></div>
    </section>
</main>

<script>
    // Check login
    const admin = localStorage.getItem("loggedInAdmin");
    if (!admin) {
        alert("You must log in first.");
        window.location.href = "login.html";
    }

    document.getElementById("welcome").textContent = `Logged in as: ${admin}`;

    // Logout button
    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("loggedInAdmin");
        localStorage.removeItem("rememberedUser");
        window.location.href = "login.html";
    });

    // Products storage helpers
    function getAllProducts() {
        return JSON.parse(localStorage.getItem("allProducts") || "[]");
    }

    function saveAllProducts(products) {
        localStorage.setItem("allProducts", JSON.stringify(products));
    }

    // Render admin's products
    function renderAdminProducts() {
        const all = getAllProducts();
        const own = all.filter(p => p.owner === admin);
        const container = document.getElementById("adminProducts");
        container.innerHTML = "";

        if (own.length === 0) {
            container.innerHTML = "<p>No products yet.</p>";
            return;
        }

        own.forEach(p => {
            container.innerHTML += `
                <div class="product">
                    <img src="${p.image}" alt="${p.name}" />
                    <p><strong>${p.name}</strong> - ₱${p.price}</p>
                    <p>Reseller: ${p.reseller}</p>
                </div>
            `;
        });
    }

    // Convert uploaded image to base64 URL
    function getBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });
    }

    // Handle new product submission
    document.getElementById("productForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        const name = document.getElementById("productName").value.trim();
        const price = parseFloat(document.getElementById("productPrice").value);
        const reseller = document.getElementById("reseller").value.trim();
        const imageFile = document.getElementById("imageFile").files[0];

        if (!imageFile) {
            alert("Please select an image file.");
            return;
        }

        const imageBase64 = await getBase64(imageFile);

        const newProduct = {
            name,
            price,
            reseller,
            image: imageBase64,
            likes: 0,
            dislikes: 0,
            owner: admin
        };

        const all = getAllProducts();
        all.push(newProduct);
        saveAllProducts(all);

        renderAdminProducts();

        this.reset();
    });

    renderAdminProducts();

    // Smooth scroll for menu links
    document.getElementById("menuAddProduct").addEventListener("click", e => {
      e.preventDefault();
      document.getElementById("addProductSection").scrollIntoView({ behavior: "smooth" });
    });

    document.getElementById("menuYourProducts").addEventListener("click", e => {
      e.preventDefault();
      document.getElementById("yourProductsSection").scrollIntoView({ behavior: "smooth" });
    });
</script>

</body>
</html>
